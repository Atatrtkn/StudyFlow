{% extends 'base.html' %}

{% block title %}İstatistikler - StudyFlow{% endblock %}

{% block content %}
<h4 class="mb-4"><i class="bi bi-bar-chart me-2"></i>İstatistikler</h4>

<div class="row g-4">
    <!-- Yoğunluk Analizi -->
    <div class="col-lg-6">
        <div class="card h-100">
            <div class="card-header"><i class="bi bi-clock me-2"></i>Saat Bazlı Yoğunluk (Son 30 Gün)</div>
            <div class="card-body p-0">
                {% if yogunluk %}
                <div class="table-responsive" style="max-height: 300px; overflow-y: auto;">
                    <table class="table table-sm mb-0">
                        <thead>
                            <tr>
                                <th>Saat Dilimi</th>
                                <th>Rezervasyon</th>
                                <th>Yoğunluk</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for y in yogunluk %}
                            <tr>
                                <td style="color: var(--text-main);">{{ y.saat_dilimi }}</td>
                                <td style="color: var(--text-main);">{{ y.rezervasyon_sayisi }}</td>
                                <td>
                                    <span class="badge bg-{{ 'danger' if y.yogunluk_seviyesi == 'YOĞUN' else 'warning' if y.yogunluk_seviyesi == 'ORTA' else 'success' }}">
                                        {{ y.yogunluk_seviyesi }}
                                    </span>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <p class="text-center py-4" style="color: var(--text-muted);">Henüz yeterli veri yok</p>
                {% endif %}
            </div>
        </div>
    </div>
    
    <!-- En Popüler Alanlar -->
    <div class="col-lg-6">
        <div class="card h-100">
            <div class="card-header"><i class="bi bi-star me-2"></i>En Popüler Alanlar</div>
            <div class="card-body p-0">
                {% if alan_doluluk %}
                <div class="table-responsive">
                    <table class="table table-sm mb-0">
                        <thead>
                            <tr>
                                <th>Alan</th>
                                <th>Konum</th>
                                <th>Toplam Rez.</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for a in alan_doluluk[:10] %}
                            <tr>
                                <td><strong style="color: var(--text-main);">{{ a.alan_adi }}</strong></td>
                                <td style="color: var(--text-muted);">{{ a.konum }}</td>
                                <td>
                                    <span class="badge bg-primary">{{ a.aktif_rezervasyon_sayisi }}</span>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <p class="text-center py-4" style="color: var(--text-muted);">Henüz veri yok</p>
                {% endif %}
            </div>
        </div>
    </div>
    
    <!-- Kişisel İstatistikler -->
    <div class="col-lg-6">
        <div class="card h-100">
            <div class="card-header"><i class="bi bi-person-badge me-2"></i>Kişisel İstatistiklerim</div>
            <div class="card-body">
                <div class="row text-center">
                    <div class="col-4">
                        <div class="p-3" style="background: var(--bg-input); border-radius: 12px;">
                            <div class="fs-3 fw-bold text-primary">{{ kisisel_stats.toplam_rezervasyon or 0 }}</div>
                            <div class="small" style="color: var(--text-muted);">Rezervasyon</div>
                        </div>
                    </div>
                    <div class="col-4">
                        <div class="p-3" style="background: var(--bg-input); border-radius: 12px;">
                            <div class="fs-3 fw-bold text-success">{{ kisisel_stats.toplam_oturum or 0 }}</div>
                            <div class="small" style="color: var(--text-muted);">Oturum</div>
                        </div>
                    </div>
                    <div class="col-4">
                        <div class="p-3" style="background: var(--bg-input); border-radius: 12px;">
                            <div class="fs-3 fw-bold text-info">{{ kisisel_stats.toplam_saat or 0 }}</div>
                            <div class="small" style="color: var(--text-muted);">Saat</div>
                        </div>
                    </div>
                </div>
                {% if kisisel_stats.en_cok_alan %}
                <div class="mt-3 p-3" style="background: var(--bg-input); border-radius: 12px;">
                    <small style="color: var(--text-muted);">En çok kullandığınız alan:</small>
                    <div class="fw-bold" style="color: var(--text-main);">{{ kisisel_stats.en_cok_alan }}</div>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
    
    <!-- Katılımcı Analizi -->
    <div class="col-lg-6">
        <div class="card h-100">
            <div class="card-header"><i class="bi bi-people me-2"></i>Kullanım Analizi</div>
            <div class="card-body">
                <div class="row">
                    <div class="col-6">
                        <h6 class="text-success"><i class="bi bi-check-circle me-1"></i>Tam Katılımcılar</h6>
                        <p class="small mb-2" style="color: var(--text-muted);">Hem rezervasyon hem oturum kaydı olanlar</p>
                        <div class="fs-2 fw-bold text-success">{{ tam_katilimci|length }}</div>
                    </div>
                    <div class="col-6">
                        <h6 class="text-warning"><i class="bi bi-exclamation-circle me-1"></i>Sadece Rezervasyon</h6>
                        <p class="small mb-2" style="color: var(--text-muted);">Rezervasyon yapıp oturum açmayanlar</p>
                        <div class="fs-2 fw-bold text-warning">{{ sadece_rezervasyon|length }}</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
